k
X
k=2
sum(dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1))
threshold
sum(dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1 & threshold))
sum(dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1))
k
k=1
sum(dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1))
k=3
sum(dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1))
plot_box<-function(X){
    par(mar=c(3,10,2,2))
#   ord2<-order(centers[X,]);
    fish<-sum(!table(data$V2[cl==X & threshold])==0)
    boxplot(data[cl==X & threshold,4+ord],names=EPlist[ord],las=2,horizontal=T,main=paste("cluster",X,"in",fish,"/",length(prefix_list),"fish"))
#   abline(v=0, lty=2,col="blue")
}
plot_box(1)
i=1
X11();plot_cluster(i);plot_box(i);i=i+1
X11();plot_cluster(i);plot_box(i);i=i+1
X11();plot_cluster(i);plot_box(i);i=i+1
X11();plot_cluster(i);plot_box(i);i=i+1
plot_dp_free <- function(c){
    logdist<-seq(min(log(dencl$V4)),range(dencl$V4,finite=T)[2],length.out=100);
    logprob<-seq(min(log(dencl$V3)),max(log(dencl$V3)),length.out=100);
    colors<-rep("black",nrow(dencl));
    colors[cl==c]="red";
    plot(log(dencl$V4)[threshold],log(dencl$V3)[threshold],col=colors,pch=19,cex=0.6,xlab="log(distance)",ylab="log(density)");
    lines(rep(thsum[1],100),logprob,lty=2,col="green")
    lines(logdist,-nEP*logdist+thsum[2],lty=2,col="green")
}
plot_dp_cluster <- function(c){
    logdist<-seq(min(log(dencl$V4)),range(dencl$V4,finite=T)[2],length.out=100);
    logprob<-seq(min(log(dencl$V3)),max(log(dencl$V3)),length.out=100);
    colors<-rep("black",nrow(dencl));
    colors[cl==c]="red";
    plot(log(dencl$V4)[threshold],log(dencl$V3)[threshold],col=colors,pch=19,cex=0.6,xlab="log(distance)",ylab="log(density)");
    lines(rep(thsum[1],100),logprob,lty=2,col="green")
    lines(logdist,-nEP*logdist+thsum[2],lty=2,col="green")
}
plot_dp_cluster(1)
plot_dp_cluster(2)
plot_dp_cluster(3)
plot_dp_cluster(4)
plot_dp_cluster(5)
plot_dp_cluster(6)
plot_dp_free(1)
plot_dp_free <- function(c){
    logdist<-seq(min(log(dencl$V4)),range(dencl$V4,finite=T)[2],length.out=100);
    logprob<-seq(min(log(dencl$V3)),max(log(dencl$V3)),length.out=100);
    colors<-rep("black",nrow(dencl));
    colors[cl==c]="red";
    plot(log(dencl$V4),log(dencl$V3),col=colors,pch=18);
    lines(rep(thsum[1],100),logprob,lty=2,col="green")
    lines(logdist,-nEP*logdist+thsum[2],lty=2,col="green")
}
plot_dp_free(1)
plot_dp_free(2)
plot_dp_free(3)
plot_dp_free(4)
plot_dp_free(5)
plot_dp_free(6)
plot_dp_free(7)
plot_dp_cluster <- function(c){
    logdist<-seq(min(log(dencl$V4)),range(dencl$V4,finite=T)[2],length.out=100);
    logprob<-seq(min(log(dencl$V3)),max(log(dencl$V3)),length.out=100);
    colors<-rep("black",nrow(dencl));
    colors[cl==c[threshold]]="red";
    plot(log(dencl$V4)[threshold],log(dencl$V3)[threshold],col=colors,pch=19,cex=0.6,xlab="log(distance)",ylab="log(density)");
    lines(rep(thsum[1],100),logprob,lty=2,col="green")
    lines(logdist,-nEP*logdist+thsum[2],lty=2,col="green")
}
plot_dp_cluster(1)
plot_dp_cluster <- function(c){
    logdist<-seq(min(log(dencl$V4)),range(dencl$V4,finite=T)[2],length.out=100);
    logprob<-seq(min(log(dencl$V3)),max(log(dencl$V3)),length.out=100);
    colors<-rep("black",nrow(dencl));
    colors[cl[threshold]==c]="red";
    plot(log(dencl$V4)[threshold],log(dencl$V3)[threshold],col=colors,pch=19,cex=0.6,xlab="log(distance)",ylab="log(density)");
    lines(rep(thsum[1],100),logprob,lty=2,col="green")
    lines(logdist,-nEP*logdist+thsum[2],lty=2,col="green")
}
plot_dp_cluster(1)
plot_dp_cluster(2)
plot_dp_cluster(3)
plot_dp_cluster(4)
plot_dp_cluster(5)
plot_dp_cluster(6)
plot_dp_cluster(7)
plot_dp_cluster(8)
i=1
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
i
i=1
i
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
i=1
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
X11();plot_cluster(i);plot_box(i);plot_dp_cluster(i);i=i+1
X<-1
 lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=4,byrow=T);
    layout(lmat)
    par(mar=c(3,3,1,1))
    colors=rainbow(max(cl));
    plot_box(X[i])
    plot_dp_cluster(X[i]);
layout
layout(lmat)
lmat
lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
    layout(lmat)
    par(mar=c(3,3,1,1))
    colors=rainbow(max(cl));
    plot_box(X[i])
    plot_dp_cluster(X[i]);
plot_box(1)
X
plot_box(X[i])
i
i=1
 lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
    layout(lmat)
    par(mar=c(3,3,1,1))
    colors=rainbow(max(cl));
    plot_box(X[i])
    plot_dp_cluster(X[i]);
 for(k in 1:length(prefix_list)){
        y=center_list[[k]]$V1+1
        x=center_list[[k]]$V2+1
        nx=dimvec_list[[k]][1]
        ny=dimvec_list[[k]][2]
        image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        if(nothresh){
            for(i in 1:length(X)){
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
}
}
 lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
    layout(lmat)
    par(mar=c(3,3,1,1))
    colors=rainbow(max(cl));
    plot_box(X[i])
    plot_dp_cluster(X[i]);
    par(mar=c(0.5,0.5,0.5,0.5))
for(k in 1:length(prefix_list)){
        y=center_list[[k]]$V1+1
        x=center_list[[k]]$V2+1
        nx=dimvec_list[[k]][1]
        ny=dimvec_list[[k]][2]
        image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        if(nothresh){
            for(i in 1:length(X)){
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        } else {
            for(i in 1:length(X)){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        }
    }
plot_cluster<-function(X,P=19,S=1.5,nothresh=F,traj_device=NA){
    lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
    layout(lmat)
    par(mar=c(3,3,1,1))
    colors=rainbow(max(cl));
    plot_box(X[i])
    plot_dp_cluster(X[i]);
    par(mar=c(0.5,0.5,0.5,0.5))
    for(k in 1:length(prefix_list)){
        y=center_list[[k]]$V1+1
        x=center_list[[k]]$V2+1
        nx=dimvec_list[[k]][1]
        ny=dimvec_list[[k]][2]
        image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        if(nothresh){
            for(i in 1:length(X)){
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        } else {
            for(i in 1:length(X)){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        }
    }
}
plot_cluster(1)
plot_cluster<-function(X,P=19,S=1.5,nothresh=F,traj_device=NA){
    lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
    layout(lmat)
    par(mar=c(1,3,1,1))
    colors=rainbow(max(cl));
    plot_box(X[i])
    plot_dp_cluster(X[i]);
    par(mar=c(0.5,0.5,0.5,0.5))
    for(k in 1:length(prefix_list)){
        y=center_list[[k]]$V1+1
        x=center_list[[k]]$V2+1
        nx=dimvec_list[[k]][1]
        ny=dimvec_list[[k]][2]
        image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        if(nothresh){
            for(i in 1:length(X)){
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        } else {
            for(i in 1:length(X)){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        }
    }
#   if(length(X)==1){
#       dc=dev.cur();
#       if(is.na(traj_device)){
#           X11();
#           plot_traj(X);
#           dev.set(dc);
#       } else {
#           dev.set(traj_device);
}
plot_cluster(1)
plot_cluster<-function(X,P=19,S=1.5,nothresh=F,traj_device=NA){
    lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
    layout(lmat)
#   par(mar=c(1,3,1,1))
    colors=rainbow(max(cl));
    plot_box(X[i])
    plot_dp_cluster(X[i]);
    par(mar=c(0.5,0.5,0.5,0.5))
    for(k in 1:length(prefix_list)){
        y=center_list[[k]]$V1+1
        x=center_list[[k]]$V2+1
        nx=dimvec_list[[k]][1]
        ny=dimvec_list[[k]][2]
        image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        if(nothresh){
            for(i in 1:length(X)){
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        } else {
            for(i in 1:length(X)){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
                selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
                points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        }
    }
#   if(length(X)==1){
#       dc=dev.cur();
#       if(is.na(traj_device)){
#           X11();
#           plot_traj(X);
#           dev.set(dc);
#       } else {
#           dev.set(traj_device);
}
plot_cluster(1)
plot_box(1)
plot_box<-function(X){
    par(mar=c(3,5,2,2))
#   ord2<-order(centers[X,]);
    fish<-sum(!table(data$V2[cl==X & threshold])==0)
    boxplot(data[cl==X & threshold,4+ord],names=EPlist[ord],las=2,horizontal=T,main=paste("cluster",X,"in",fish,"/",length(prefix_list),"fish"))
#   abline(v=0, lty=2,col="blue")
}
plot_box(1)
plot_box<-function(X){
    par(mar=c(3,7,2,2))
#   ord2<-order(centers[X,]);
    fish<-sum(!table(data$V2[cl==X & threshold])==0)
    boxplot(data[cl==X & threshold,4+ord],names=EPlist[ord],las=2,horizontal=T,main=paste("cluster",X,"in",fish,"/",length(prefix_list),"fish"))
#   abline(v=0, lty=2,col="blue")
}
plot_box(1)
source("DC2_PVN_pulled.R")
plot_cluster(1)
plot_cluster(1)
lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
    layout(lmat)
#   par(mar=c(1,3,1,1))
    colors=rainbow(max(cl));
X<-1
 plot_box(X[i])
    plot_dp_cluster(X[i]);
plot_box(1)
i
i=1
plot_cluster<-function(X,P=19,S=1.5,nothresh=F,traj_device=NA){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
    if(nothresh){
    for(i in 1:length(X)){
        lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        plot_dp_cluster(X[i]);  
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
            selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
            points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        } else {
    for(i in 1:length(X)){
    lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        plot_dp_cluster(X[i]);
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
        points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
                }
            }
        }
    }
}
plot_cluster<-function(X,P=19,S=1.5,nothresh=F,traj_device=NA){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
    if(nothresh){
    for(i in 1:length(X)){
        lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        plot_dp_cluster(X[i]);  
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
            selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
            points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        } else {
    for(i in 1:length(X)){
    lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        plot_dp_cluster(X[i]);
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
        points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
                }
            }
        }
    }
}
plot_cluster<-function(X,P=19,S=1.5,nothresh=F,traj_device=NA){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
    if(nothresh){
    for(i in 1:length(X)){
        lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        plot_dp_cluster(X[i]);  
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
            selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
            points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        } 
        }else {
    for(i in 1:length(X)){
    lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        plot_dp_cluster(X[i]);
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
        points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
                }
            }
        }
    }
plot_cluster(1)
source("DC2_PVN_pulled.R")
plot_cluster(1)
source("DC2_PVN_pulled.R")
plot_cluster(1)
plot_box<-function(X){
#   par(mar=c(3,7,2,2))
#   ord2<-order(centers[X,]);
    fish<-sum(!table(data$V2[cl==X & threshold])==0)
    boxplot(data[cl==X & threshold,4+ord],names=EPlist[ord],las=2,horizontal=T,main=paste("cluster",X,"in",fish,"/",length(prefix_list),"fish"))
#   abline(v=0, lty=2,col="blue")
}
plot_box(1)
plot_cluster<-function(X,P=19,S=1.5,nothresh=F,traj_device=NA){
#dencl_list[[k]]$V6 : C1 ID from fish k
#data$V4            : C1 ID
#data$V2            : prefix
    if(nothresh){
    for(i in 1:length(X)){
        lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        plot_dp_cluster(X[i]);
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
            selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i]]-1)
            points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
            }
        }
        }else {
    for(i in 1:length(X)){
    lmat=matrix(c(1,1,3,1,1,4,2,2,5,2,2,6),ncol=3,byrow=T);
        layout(lmat)
        colors=rainbow(max(cl));
        plot_box(X[i])
        par(mar=c(3,7,2,2))
        plot_dp_cluster(X[i]);
        par(mar=c(0.5,0.5,0.5,0.5))
        for(k in 1:length(prefix_list)){
            y=center_list[[k]]$V1+1
            x=center_list[[k]]$V2+1
            nx=dimvec_list[[k]][1]
            ny=dimvec_list[[k]][2]
            image(1:nx,1:ny,matrix(avtab_list[[k]]$V2,ncol=ny,nrow=nx),ylim=c(ny+0.5,0.5),col=gray.colors(100),xaxt='n',yaxt='n',ann=FALSE)       ;
        selec=dencl_list[[k]]$V6 %in% (data$V4[data$V2==prefix_list[k] & cl==X[i] & threshold]-1)
        points(x[ selec  ],y[selec ],col=martincolorscale[i],pch=P,cex=S)
                }
            }
        }
    }
plot_cluster(1)
source("DC2_PVN_pulled.R")
plot_cluster(1)
source("DC2_PVN_pulled.R")
plot_cluster(1)
source("DC2_PVN_pulled.R")
plot_cluster(1)
X11()
par(mfrow=c(2,2))
plot_cluster(1)
plot_cluster(1)
plot_cluster(2)
plot_cluster(3)
plot_cluster(4)
ord
plot_cluster(1)
quit()
